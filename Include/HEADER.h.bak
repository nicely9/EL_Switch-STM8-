
#ifndef _MAIN_H
#define _MAIN_H

#include <stdio.h>
#include <stdarg.h>
#include <stdlib.h>
#include <string.h>
#include <math.h>
#include "stm8l15x.h"
#include "queue.h"
#include "eeprom.h"
#include "touch.h"



//-------------------------------------------------------------------------------------------------------------------------
#define	VERSION		(uint16_t)(002)
//=========================================================================================================================
//#define		_TOUCH_SENSITIVITY_TEST_			// 터치 chip SENSITIVITY 설정 프로그램 테스트 모드, release 버젼에서는 반드시 해제해야 함
//=========================================================================================================================
// 3가지 모델중 하나 선택 후 각 모델별 상세모델 선택
//#define		_ONE_SIZE_LIGHT_MODEL_						// 1개용 모델
//#define		_TWO_SIZE_LIGHT_MODEL_					// 2개용 전등 모델
#define		_TWO_SIZE_LIGHT_n_ELEC_MODEL_				// 2개용 전등,전열 모델
//=========================================================================================================================
#ifdef		_TWO_SIZE_LIGHT_MODEL_
//-------------------------------------------------------------------------------------------------------------------------
//#define		_TWO_SIZE_LIGHT_3_						// 2개용 전등3
#define		_TWO_SIZE_LIGHT_4_						// 2개용 전등4
//#define		_TWO_SIZE_LIGHT_5_						// 2개용 전등5
//#define		_TWO_SIZE_LIGHT_6_						// 2개용 전등6
//-------------------------------------------------------------------------------------------------------------------------
#endif
//=========================================================================================================================
#ifdef		_TWO_SIZE_LIGHT_n_ELEC_MODEL_
//-------------------------------------------------------------------------------------------------------------------------
//#define		_TWO_SIZE_LIGHT_1_n_ELEC_2_					// 2개용 전등1, 전열2
//#define		_TWO_SIZE_LIGHT_2_n_ELEC_2_					// 2개용 전등2, 전열2
//#define		_TWO_SIZE_LIGHT_3_n_ELEC_2_					// 2개용 전등3, 전열2
//#define		_TWO_SIZE_LIGHT_4_n_ELEC_2_					// 2개용 전등4, 전열2
//#define       _TWO_SIZE_LIGHT_1_n_ELEC_2_n_LCD_           // 2개용 전등1, 전열2, LCD
//#define		_TWO_SIZE_LIGHT_2_n_ELEC_2_n_LCD_			// 2개용 전등2, 전열2, LCD
//#define		_TWO_SIZE_LIGHT_3_n_ELEC_2_n_LCD_			// 2개용 전등3, 전열2, LCD
#define		_TWO_SIZE_LIGHT_4_n_ELEC_2_n_LCD_			// 2개용 전등4, 전열2, LCD
//#define		_TWO_SIZE_LIGHT_1_n_ELEC_2_n_LCD_n_DIM_1_	// 2개용 전등1, 전열2, LCD, Dimming1
//#define		_TWO_SIZE_LIGHT_2_n_ELEC_2_n_LCD_n_DIM_1_	// 2개용 전등2, 전열2, LCD, Dimming1
//#define		_TWO_SIZE_LIGHT_3_n_ELEC_2_n_LCD_n_DIM_1_	// 2개용 전등3, 전열2, LCD, Dimming1
//#define		_TWO_SIZE_LIGHT_4_n_ELEC_2_n_LCD_n_DIM_1_	// 2개용 전등4, 전열2, LCD, Dimming1
//#define		_TWO_SIZE_LIGHT_1_n_ELEC_2_n_LCD_n_DIM_2_	// 2개용 전등1, 전열2, LCD, Dimming2
//#define		_TWO_SIZE_LIGHT_2_n_ELEC_2_n_LCD_n_DIM_2_	// 2개용 전등2, 전열2, LCD, Dimming2
//#define		_TWO_SIZE_LIGHT_3_n_ELEC_2_n_LCD_n_DIM_2_	// 2개용 전등3, 전열2, LCD, Dimming2
//#define		_TWO_SIZE_LIGHT_4_n_ELEC_2_n_LCD_n_DIM_2_	// 2개용 전등4, 전열2, LCD, Dimming2
//-------------------------------------------------4------------------------------------------------------------------------
#endif
//=========================================================================================================================
#ifdef		_ONE_SIZE_LIGHT_MODEL_		
//-------------------------------------------------------------------------------------------------------------------------
//#define		_ONE_SIZE_BATCH_LIGHT_n_GAS_n_ELEVATOR_	// 1개용 일괄소등, 가스차단, 엘리베이터 호출
//#define		_ONE_SIZE_BATCH_LIGHT_n_GAS_n_3WAY_		// 1개용 일괄소등, 가스차단, 삼로
//#define		_ONE_SIZE_BATCH_LIGHT_n_GAS_			// 1개용 일괄소등, 가스차단
#define		_ONE_SIZE_BATCH_LIGHT_					// 1개용 일괄소등
//#define		_ONE_SIZE_LIGHT_1_						// 1개용 전등1
//#define		_ONE_SIZE_LIGHT_2_						// 1개용 전등2
//#define		_ONE_SIZE_LIGHT_3_						// 1개용 전등3
//-------------------------------------------------------------------------------------------------------------------------
#endif
//=========================================================================================================================
//#define	_ADC_
#ifdef		_ADC_
#define	_LSI_MEASURMENT_		// LSI Calibration
#endif
//#define	_WWDG_
//-------------------------------------------------------------------------------------------------------------------------
#define	_STATE_DIFF_SAVE__
//-------------------------------------------------------------------------------------------------------------------------
#define	STPM3x_POWER
//#define	STPM3x_ENERGY
#define	STPM3x_OFFSET_SETTING
//#define	STPM3x_READ_SR
#define	_STPM3x_AUTO_LATCH_
//#define		_STPM3x_MIN_READ_
//-------------------------------------------------------------------------------------------------------------------------
//-------------------------------------------------------------------------------------------------------------------------
#define	ERR_FLAG_TOUCH_CHIP_1	0x0001
#define	ERR_FLAG_TOUCH_CHIP_2	0x0002
#define	ERR_FLAG_TOUCH_TIMEOUT	0x0004

extern uint16_t	Gu16_ERR_Flag;
extern uint8_t	Gu8_SystemInit;

//-------------------------------------------------------------------------------------------------------------------------
//extern double sqrt(double x);

//-------------------------------------------------------------------------------------------------------------------------
#define delay(a)          {	Gu16_1ms_delay_tmr = a;	while(Gu16_1ms_delay_tmr){WDG_SetCounter();} }

// STM8L052R8
#define	DEBUG_USART					USART2
#define	DEBUG_PORT_CLK				CLK_Peripheral_USART2
#define	DEBUG_RX_PORT				GPIOE
#define	DEBUG_TX_PORT				GPIOE
#define	DEBUG_RX_PIN				GPIO_Pin_3
#define	DEBUG_TX_PIN				GPIO_Pin_4

#define	RS_485_USART				USART3
#define	RS_485_PORT_CLK				CLK_Peripheral_USART3
#define	RS_485_RX_PORT				GPIOG
#define	RS_485_TX_PORT				GPIOG
#define	RS_485_RX_PIN				GPIO_Pin_0
#define	RS_485_TX_PIN				GPIO_Pin_1
#define	RS_485_DE_PORT				GPIOG
#define	RS_485_DE_PIN				GPIO_Pin_2
//----------------------------------------------------------------------------------
#define	STPM3x_USART				USART1
#define	STPM3x_PORT_CLK				CLK_Peripheral_USART1
#define	STPM3x_RX_PORT				GPIOA
#define	STPM3x_TX_PORT				GPIOA
#define	STPM3x_RX_PIN				GPIO_Pin_3
#define	STPM3x_TX_PIN				GPIO_Pin_2

#define	STPM3x_SYN_PORT				GPIOF
#define	STPM3x_SYN_PIN				GPIO_Pin_7

#define	ADuM5010_PDIS_PORT			GPIOF
#define	ADuM5010_PDIS_PIN			GPIO_Pin_6
//----------------------------------------------------------------------------------
#define	IR_RECEVIE_PORT				GPIOA			// TIM5 CH1
#define	IR_RECEVIE_PIN				GPIO_Pin_7
//----------------------------------------------------------------------------------
#define	TEMPERATURE_ADC_CH			ADC_Channel_4	// GPIOC, GPIO_Pin_4		Slow
#define	AC_VOLTAGE_ADC_CH			ADC_Channel_11	// GPIOB, GPIO_Pin_7		Slow
#define	VREFINT_5_0V_CH				ADC_Channel_22	// 
#define	CT_SENSOR_1_ADC_CH			ADC_Channel_24	// GPIOF, GPIO_Pin_0		Fast
#define	CT_SENSOR_2_ADC_CH			ADC_Channel_25	// GPIOF, GPIO_Pin_1		Fast
#define	VREFINT_ADC_CH				ADC_Channel_Vrefint
//----------------------------------------------------------------------------------
#define	ENABLE_BIT_DIMMING_1		0x01
#define	ENABLE_BIT_DIMMING_2		0x02
#define	ENABLE_BIT_THREE_WAY_1		0x01
#define	ENABLE_BIT_THREE_WAY_2		0x02

#define	DIMMING_OUT_1_PORT			GPIOD
#define	DIMMING_OUT_1_PIN			GPIO_Pin_4
#define	DIMMING_OUT_2_PORT			GPIOD
#define	DIMMING_OUT_2_PIN			GPIO_Pin_5
// OR
#define	THREE_WAY_IN_1_PORT			GPIOD
#define	THREE_WAY_IN_1_PIN			GPIO_Pin_4
#define	THREE_WAY_IN_1_EXTI			EXTI_Pin_4
#define	THREE_WAY_IN_2_PORT			GPIOD
#define	THREE_WAY_IN_2_PIN			GPIO_Pin_5
#define	THREE_WAY_IN_2_EXTI			EXTI_Pin_5
//----------------------------------------------------------------------------------
#define	RELAY_1_PORT				GPIOD
#define	RELAY_1_PIN					GPIO_Pin_6
#define	RELAY_2_PORT				GPIOD
#define	RELAY_2_PIN					GPIO_Pin_7
#define	RELAY_3_PORT				GPIOC
#define	RELAY_3_PIN					GPIO_Pin_5
#define	RELAY_4_PORT				GPIOC
#define	RELAY_4_PIN					GPIO_Pin_6

#define	LATCH_RELAY_1_1_PORT		GPIOG
#define	LATCH_RELAY_1_1_PIN			GPIO_Pin_4
#define	LATCH_RELAY_1_2_PORT		GPIOG
#define	LATCH_RELAY_1_2_PIN			GPIO_Pin_5
#define	LATCH_RELAY_2_1_PORT		GPIOG
#define	LATCH_RELAY_2_1_PIN			GPIO_Pin_6
#define	LATCH_RELAY_2_2_PORT		GPIOG
#define	LATCH_RELAY_2_2_PIN			GPIO_Pin_7
//----------------------------------------------------------------------------------
#define	TOUCH_RESET_PORT			GPIOE
#define	TOUCH_RESET_PIN				GPIO_Pin_7

#define	TOUCH_INT_1_PORT			GPIOC
#define	TOUCH_INT_1_PIN				GPIO_Pin_2
#define TOUCH_INT_1_EXTI			EXTI_Pin_2

#define	TOUCH_INT_2_PORT			GPIOC
#define	TOUCH_INT_2_PIN				GPIO_Pin_3
#define TOUCH_INT_2_EXTI			EXTI_Pin_3
//----------------------------------------------------------------------------------
#define	ZERO_CROSSING_PORT			GPIOC
#define	ZERO_CROSSING_PIN			GPIO_Pin_7
#define ZERO_CROSSING_EXTI			EXTI_Pin_7

#define	SYSTEM_PVD_PORT				GPIOE
#define	SYSTEM_PVD_PIN				GPIO_Pin_6
//----------------------------------------------------------------------------------

#define	Brownout_Reset_ENABLE			0x01
#define	Brownout_Reset_DISABLE			0x00
#define	Brownout_Reset_Threshold_0_2V75	(0x00)
#define	Brownout_Reset_Threshold_1_2V04	(0x01<<1)
#define	Brownout_Reset_Threshold_2_2V41	(0x02<<1)
#define	Brownout_Reset_Threshold_3_2V66	(0x03<<1)
#define	Brownout_Reset_Threshold_4_2V90	(0x04<<1)

#endif
